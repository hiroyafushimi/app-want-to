# アプリ名称: Wan to 
# バージョン: 1.0.0 - 最終仕様書（共有シート起点・ユーザーAPI Key版・分類＆プロンプト確定）  
# 作成日: 2026-02-08  
# 作成者: bay  
# 目的: スクショ画像を共有シート経由で受け取り、指で範囲指定→OCR→テキスト化。内容を分類し、次のアクションを提案・実行。AIはユーザー自身のAPI Keyで外部処理。コストゼロ・セキュリティ最優先。

## 1. プロジェクト概要

### 1.1 プロダクトゴール
- スクショ → 共有シート → 本アプリ起動 → 指で囲む → OCR → テキスト化
- 囲った内容を分類（商品/文章/その他） → アクション提案
  - 商品 → 通販サイト比較検索URL生成（Amazon/Rakuten/Yahoo）
  - 文章 → ユーザーが設定したAI Agentにテキスト送信（要約/質問/翻訳など）
  - その他 → コピー / OS共有（Line/Slack/メール）
- 常駐・オーバーレイなし、共有シート起点でOS標準動作
- AI処理はアプリ側ゼロ → ユーザーAPI Keyで外部LLM呼び出し

### 1.2 ターゲットユーザー
- 20〜45歳 日本人（エンジニア、リサーチャー、ライター、学生など）
- スクショ → 部分抽出 → 検索/共有/質問 を頻繁に行う層
- API Keyを設定できる技術リテラシー中〜高
- 無料で基本機能を使い、便利さを実感したら課金する層

### 1.3 非機能要件（最優先）
- オフラインOCR（デバイス内）
- AIはオンラインかつユーザーAPI Keyのみ（アプリ側コスト0円）
- API Keyセキュリティ：
  - flutter_secure_storage で暗号化保存
  - 画面表示時はマスク（****-****）のみ
  - ログ出力・クリップボード・ネットワーク送信禁止
  - アプリ削除でKeyも消去
- 画像制限：最大5MB / 4096×4096px、超過時は自動縮小 or エラー
- 対応形式：JPEG, PNG, HEIC（iOS）
- アプリサイズ 50MB以内

### 1.4 マネタイズ設計
| プラン     | 価格（税込）   | 内容                                                                 | LTV見込み / 備考                     |
|------------|----------------|----------------------------------------------------------------------|---------------------------------------|
| 無料       | ¥0             | 1日5回OCR + ルールベース分類 + 通販URL生成 + AI送信1回/日           | 初期獲得重視、CAC ¥400以内目標        |
| 月額       | ¥480 / 月      | 無制限 + ML Kit分類（6回/日） + AI送信無制限 + 優先サポート         | 継続率45%目標（LTV ¥1,300前後）      |
| 買い切り   | ¥2,200（一括） | 永年無制限（ML Kit分類含む、AI送信無制限）                           | Androidユーザー向け選択肢            |

- 広告：MVPでは入れない
- 課金誘導：無料回数終了直後に自然表示（A/Bテスト必須）

## 2. MVPスコープ

### インスコープ
- 共有シートから画像受信
- 指で囲む/線引き → 範囲OCR（日本語縦書き対応）
- 分類ロジック（詳細後述）
- アクション提示：
  - 商品：Amazon/Rakuten/Yahoo検索URL → ブラウザ起動
  - 文章：AI送信（デフォルト/カスタムプロンプト） → 結果表示
  - その他：コピー / OS共有
- API Key設定画面
- 無料回数制限 + エラー処理

### アウトオブスコープ（MVP切る）
- 常駐・オーバーレイ
- アプリ内ブラウザ
- カメラ直接起動
- 多言語 / 手書き
- PDF出力 / 履歴保存

## 3. 技術スタック

| 項目             | iOS推奨                  | Android推奨                  | 備考・コスト観点                     |
|------------------|--------------------------|------------------------------|--------------------------------------|
| フレームワーク   | Flutter                  | Flutter                      | 開発コスト半減                       |
| OCR              | Apple Vision             | Google ML Kit                | 無料・オフライン                     |
| 分類（基本）     | Vision + ルールベース    | ML Kit + ルールベース        | 無料で軽量                           |
| 分類（高度）     | -                        | ML Kit Entity Extraction     | 有料限定・回数制限                   |
| AI連携           | httpパッケージ           | httpパッケージ               | ユーザーAPI Keyで外部コール         |
| 共有受信         | Share Extension          | Intent Filter                | OS標準                               |
| Key保存          | flutter_secure_storage   | flutter_secure_storage       | 暗号化                               |
| 課金             | RevenueCat               | RevenueCat                   | 管理楽                               |

## 4. 分類ロジック（詳細決定）

- **無料プラン**：ルールベースのみ
  - 商品判定キーワード/パターン：
    - ¥、円、税込、送料、Amazon、楽天、Yahoo!ショッピング、価格、セール、在庫、購入、カート
    - 正規表現：\d+円、\d+,\d+円、¥\d+、amazon.co.jp、rakuten.co.jp など
- **有料プラン**（追加価値）：ML Kitエンティティ抽出を試用可能（無料3回/日、有料6回/日 → 反応見て調整）
  - ENTITY_TYPE_PRICE, ENTITY_TYPE_URL などを活用
- **誤判定フォールバックUI**（全プラン必須）
  - OCR結果画面に表示：「このテキストはどの内容ですか？」
  - 大項目（ラジオ/セグメント）：商品 / 文章 / その他
  - 小項目（フリー入力、100文字まで）：例「楽天セールページ」「ブログ引用」「Slackメッセージ」
  - 小項目入力は次回分類のヒントとしてローカル保存（任意）

## 5. AI連携プロンプト設計（詳細決定）

- **デフォルトプロンプトセット**（選択式）
  1. 要約（300字以内）：「以下のテキストを300字以内で簡潔に要約してください。」
  2. 質問回答：「以下のテキストを読んで、ユーザーの質問に答えてください。質問：{小項目フリー入力}」
  3. 翻訳（日本語→英語）：「以下のテキストを自然な英語に翻訳してください。」
  4. カスタム：「{小項目フリー入力}」
- **UIフロー**
  - AIボタン押下 → モーダル表示
    - 大項目選択：要約 / 質問 / 翻訳 / カスタム
    - 小項目：フリー入力（100文字まで）
  - 送信 → 結果表示（コピー可能）
- **制限**：無料1日1回、有料無制限

## 6. 画面フロー概要

1. 共有シート経由起動 → 受信画像表示
2. 範囲指定画面 → 囲み → OCR実行
3. 結果画面
   - テキスト表示
   - 分類結果 + フォールバック選択UI
   - アクションボタン（商品/文章/その他）
4. AIモーダル（文章選択時）
5. 設定画面：API Key入力、残り回数、課金

## 7. エラー処理・初回オンボーディング

- **API Keyエラー**：明確メッセージ + 再入力導線
- **ネットワークエラー**：AIボタン非活性 + 「インターネット接続が必要です」
- **初回チュートリアル**（3スライド）
  1. スクショ → 共有 → アプリ選択
  2. 囲んでOCR
  3. API Key設定（任意）でAIが使えます

## 8. リスクと対応（最終確認）

| リスク                       | 確度 | 影響 | 対応策                              |
|------------------------------|------|------|-------------------------------------|
| API Key漏洩                  | 低   | 致命 | 暗号化 + 表示/ログ禁止              |
| 分類精度低                   | 中   | 中   | ルール + 手動フォールバック         |
| 共有シート認知度低           | 中   | 中   | チュートリアル強化                  |
| 課金転換率低                 | 高   | 大   | A/Bテスト + 無料で基本価値提供      |

## 9. 次工程（Cursor活用推奨）
1. このMDをCursorにインポート
2. 共有インテント受信 → 画像表示の実装
3. 範囲選択 + OCR実装
4. 分類ルールベース実装
5. API Key設定 + セキュア保存実装
6. プロトタイプ検証 → 精度・UX確認
