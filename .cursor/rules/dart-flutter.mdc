---
description: Wan to の Dart/Flutter コーディング規約と実装方針
globs: "**/*.dart"
alwaysApply: false
---

# Dart / Flutter 規約（Wan to）

## 基本
- 共有シート起点で起動。常駐・オーバーレイは使わない
- OCR はオフライン（Apple Vision / ML Kit）のみ。画像は最大 5MB / 4096×4096px まで

## API Key と Secure Storage
- 保存・取得は `flutter_secure_storage` のみ
- コード内に API Key をハードコードしない。ログ・クリップボード・ネットワーク送信に含めない
- UI 表示時はマスク（例: `****-****-****`）のみ

## 分類ロジック
- 無料: ルールベース（キーワード・正規表現: ¥、円、税込、amazon.co.jp 等）
- 有料: ML Kit Entity Extraction を回数制限で利用可能
- 誤判定時はフォールバック UI（「このテキストはどの内容ですか？」→ 商品/文章/その他 + 小項目フリー入力 100 文字）

## AI 連携
- `http` パッケージでユーザー API Key をヘッダに載せて外部 LLM 呼び出し
- デフォルトプロンプト: 要約（300 字以内）/ 質問回答 / 翻訳（日→英）/ カスタム（小項目フリー入力 100 文字）
- 無料: 1 日 1 回、有料: 無制限

## エラー処理
- API Key エラー: 明確メッセージ + 再入力導線
- ネットワークエラー時: AI ボタン非活性 + 「インターネット接続が必要です」

## 参照
- 仕様書: `SPEC_WANT_TO.md`
